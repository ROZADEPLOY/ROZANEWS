
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–æ–∑–∞ | –°–æ—Ç—Ä—É–¥–Ω–∏–∫</title>
  <style>
    body { background-color: #0e1a15; color: white; font-family: sans-serif; padding: 2rem; }
    .task, .alert, .upload { margin-bottom: 2rem; padding: 1rem; background: #1b1b1b; border-left: 4px solid #1e8b47; }
    h2 { color: #1e8b47; }
    input, textarea, button {
      width: 100%;
      max-width: 400px;
      margin: 0.5rem 0;
      padding: 0.5rem;
    }
    button { background: #1e8b47; color: white; border: none; cursor: pointer; }
    button:hover { background: #145d31; }
  </style>
</head>
<body>
  <div class="task">
    <h2>–í–∞—à–∏ –∑–∞–¥–∞—á–∏</h2>
    <div id="tasks"></div>
  </div>

  <div class="alert">
    <h2>–£—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–≥–∏</h2>
    <div id="alert"></div>
  </div>

  <div class="upload">
    <h2>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç</h2>
    <textarea id="report" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç—á—ë—Ç"></textarea>
    <button onclick="sendReport()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

<script>
const userId = 7264453091;
fetch("/api/get_tasks", {
  method: "POST",
  headers: {"Content-Type": "application/json"},
  body: JSON.stringify({user_id: userId})
}).then(res => res.json()).then(data => {
  const container = document.getElementById("tasks");
  data.forEach(t => {
    const div = document.createElement("div");
    div.innerHTML = `<strong>${t.title}</strong><br>${t.body}<hr>`;
    container.appendChild(div);
  });
});

fetch("/api/get_alert").then(res => res.json()).then(data => {
  document.getElementById("alert").textContent = data.active ? `üö® ${data.level}` : "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–≤–æ–≥";
});

function sendReport() {
  fetch("/api/upload_result", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ user_id: userId, text: document.getElementById("report").value })
  }).then(() => alert("–û—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"));
}
</script>
</body>
</html>
